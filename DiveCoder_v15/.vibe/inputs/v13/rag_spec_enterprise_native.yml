# Dive Coder / V13 - RAG spec (enterprise + native deps)
#
# This spec enables:
# - GraphRAG + RAPTOR + CRAG (offline-safe)
# - Dense retrieval + ANN (HNSWlib) with provider-based embeddings
# - Cross-encoder reranking (sentence-transformers)
#
# NOTE: you must install deps:
#   pip install -U numpy hnswlib sentence-transformers
# Optional (OpenAI embeddings):
#   pip install -U openai

sources:
  - source: repo:README
    type: markdown
    path: README.md
    meta: { scope: repo }

  - source: repo:VIBE_OVERVIEW
    type: markdown
    path: VIBE_CODER_V13_OVERVIEW.md
    meta: { scope: repo }

  - source: repo:SKILLS_AUDIT
    type: markdown
    path: docs/SKILLS_AUDIT.md
    meta: { scope: docs }

settings:
  # Techniques
  preset: 2
  enable_graphrag: true
  enable_raptor: true
  enable_crag: true
  crag_max_passes: 1
  graphrag_expand_k: 8
  raptor_summary_k: 6

  # Dense + ANN
  enable_dense: true
  dense_backend: hnswlib   # scan | hnswlib | faiss
  dense:
    # Choose ONE provider:
    #   - sentence_transformers (offline/local)  âœ… recommended for enterprise
    #   - openai (cloud)
    provider: sentence_transformers
    model: all-MiniLM-L6-v2
    dim: 384
    topk: 32

  # Hybrid fusion
  fusion:
    mode: rrf
    rrf_k: 60
    w_bm25: 1.0
    w_dense: 1.0

  # Rerank
  enable_rerank: true
  rerank:
    provider: cross_encoder
    model: cross-encoder/ms-marco-MiniLM-L-6-v2
    topk: 12
